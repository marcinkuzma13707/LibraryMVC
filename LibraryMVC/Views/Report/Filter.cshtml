<h1>Filters</h1>

<div class="container">
    <div class="row">
        <div class="col-sm-3">
            <h4>Genre</h4>
            @(Html.Kendo().ComboBox()
          .Name("genreComboBox")
          .Filter("contains")

          .Placeholder("Select genre")
          .DataTextField("Name")
          .Events(it => it.Change("cbIsChanged"))
          .DataValueField("BookGenreId")
          .DataSource(source =>
          {
              source.Read(read =>
              {
                  read.Action("GetGenres", "Report"); //Set the Action and Controller names.
              })
              .ServerFiltering(false); //If true, the DataSource will not filter the data on the client.
          })
          .Suggest(true)
          .HtmlAttributes(new { style = "width:100%;" })
            )
        </div>
        <div class="col-sm-3">
            <h4>Title</h4>
            @(Html.Kendo().AutoComplete()
      .Name("AutoCompleteTitle") //The name of the AutoComplete is mandatory. It specifies the "id" attribute of the widget.
      .DataTextField("Title") //Specify which property of the Product to be used by the AutoComplete.
      .Filter("contains")
      .DataSource(source =>
      {
          source.Read(read =>
          {
              read.Action("GetTitles", "Report").Data("onAdditionalData"); //Set the Action and Controller names.
          })
          .ServerFiltering(true); //If true, the DataSource will not filter the data on the client.
      })
            )
        </div>
        <div class="col-sm-3">
            <h4>Date from</h4>
            @(Html.Kendo().DatePicker()
              .Name("dateFrom")

              .HtmlAttributes(new { style = "width: 100%" })
            )
        </div>
        <div class="col-sm-3">
            <h4>Date to</h4>
            @(Html.Kendo().DatePicker()
              .Name("dateTo")

              .HtmlAttributes(new { style = "width: 100%" })
            )
        </div>
    </div>
    <br />
    <div class="row">
        <div class="col-sm-5">
            <input type="button" class="btn btn-success" value="Filter" id="filterBtn" />
            <input type="button" class="btn btn-danger" value="Reset" id="resetBtn" />
            </div>
        </div>
</div>



<script> 
    cbIsChanged = function (e) {
        if (this.value() && this.selectedIndex == -1) {              
            this.value('');
        }
        }
        function onAdditionalData() {
            return {
                title: $("#AutoCompleteTitle").val()
            };
        }

        $("#filterBtn").click(function searchGrid() {
            var genre = $("#genreComboBox").val();
            var title = $("#AutoCompleteTitle").val();
            var dateFrom = $("#dateFrom").val();
            var dateTo = $("#dateTo").val();
           
            var url = '@Url.Action("LoadBooksToGrid", "Report")';
            $.post(url, { genre: genre, title: title, dateFrom: dateFrom, dateTo:dateTo }, function callback(result) {
                    $.each(result, function(index) {
                        result[index].AddDate = new Date(parseInt(result[index].AddDate.substr(6)));
                    });
                $('#bookGrid').data("kendoGrid").dataSource = new kendo.data.DataSource({ data: result });
                $('#bookGrid').data("kendoGrid").dataSource.read();
                $('#bookGrid').data("kendoGrid").refresh();
            });
        });


        $("#resetBtn").click(function searchGrid() {
            var gridDataSource = $("#bookGrid").data("kendoGrid").dataSource;
            var url = '@Url.Action("Books_Read", "Report")';
            $.get(url, function callback(result) {
                $.each(result, function (index) {
                    result[index].AddDate = new Date(parseInt(result[index].AddDate.substr(6)));
                });
                $("#genreComboBox").data("kendoComboBox").text('');
                $("#AutoCompleteTitle").data("kendoAutoComplete").value("");
                $("#dateFrom").data("kendoDatePicker").value(null);
                $("#dateTo").data("kendoDatePicker").value(null);
                $('#bookGrid').data("kendoGrid").dataSource = new kendo.data.DataSource({ data: result });
                $('#bookGrid').data("kendoGrid").dataSource.read();
                $('#bookGrid').data("kendoGrid").refresh();

            });
        });

  </script>